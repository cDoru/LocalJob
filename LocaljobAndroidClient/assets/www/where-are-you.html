<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bootstrap, from Twitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="./css/bootstrap.css" rel="stylesheet">
    <link href="./css/jasny-bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      	background-color:#007E94;
      }
    </style>
    <link href="./css/bootstrap-responsive.css" rel="stylesheet">
    <link href="./css/jasny-bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="./js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="./ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="./ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="./ico/favicon.png">
  
  <script>
    var id_watch = null;
    
    inCasoDiSuccesso = function(position){
       document.getElementById("posizione_corrente").insertAdjacentHTML('beforeend',
        "<li> Lat: " + position.coords.latitude + ", Lon: " + position.coords.longitude + "</li>"
       );
    }
    
    sospendiLaRicezione = function(){
        navigator.geolocation.clearWatch(id_watch);
    }
    
    window.onload = function(){
        controlloIndirizzo();
    }
    
    
    
    
    function controlloIndirizzo(){
    	
    	//Chiamata al server che controlla se l'utente ha già un indirizzo predefinito oppure no
    	
    	//ora per prova facciamo finta che non abbia indirizzo
    	indirizzo = true;
    	
    	//se non ha indirizzo vai sul tab altro, lo geolocalizzi, ti trova lat e long
    	//e ti inserisce l'indirizzo nel form (da fare)
    	if (indirizzo == false){
    		goTabAltro(indirizzo);	
    	}
    	//se ha l'indirizzo vai sul tab casa, prende dal database tutte le info
    	//e le mostra nel form 
    	else{
    		goTabCasa(indirizzo);
    		
    	}
    	
    }
    
    function goTabAltro(indirizzo){
    	//Funzione che manda al tab altro (quindi con geolocalizzazione)
    	
    	//Fai prima un controllo...se non ha indirizzi predefiniti...non ha la 
    	//possibilità di cliccare nel tab casa ... altrimenti si
    		
    		if (indirizzo == false){	
	    		alert("non ha indirizzo casa");
	    		//Il tab casa deve essere disabilitato e non ci si può cliccare nulla
	    		$('#tab_casa').attr('class','disabled');
	    		$('#tab_casa').html('<a>Casa</a>');
    		}
    		else{
    			$('#tab_casa').attr('class','');
    			$('#tab_casa').html('<a onclick="goTabCasa(true);" data-toggle="tab">Casa</a>');
    		}
    		//Il tab altro è attivato e viene mostrato il div #tabAltro
    		$('#tab_altro').attr('class','active');
    		$('#tab_altro').html('<a href="#tabAltro" data-toggle="tab">Altro</a>');
    		
    		//Attivo la pagina tabAltro e disattivo tabCasa
    		$('#tabAltro').attr('class','tab-pane active');
    		$('#tabCasa').attr('class','tab-pane');
    		
    		//Fa partire la geolocalizzazione
    		id_watch = navigator.geolocation.watchPosition(inCasoDiSuccesso);
    		
    		//Mostra il punto sulla mappa
    		$('#map_altro').html('<h2>La tua posizione attuale</h2><span id="posizione_corrente"></span>');
    		
    		//una volta che mi darà la posizione corrente, dalle google API trovo indirizzo ecc
    		//dati di prova
    		indirizzo ="via mura anteo zamboni";
    		nciv="2";
    		cap="40127";
    		citta="bologna";
    		provincia="BO";
    		//
    		//Inserisco i valori nel form
    		$('#Indirizzo_altro').attr('value',indirizzo);
    		$('#nCiv_altro').attr('value',nciv);
    		$('#CAP_altro').attr('value',cap);
    		$('#Citta_altro').attr('value',citta);
    		$('#Provincia_altro').attr('value',provincia);
	
    }
    
    function goTabCasa(indirizzo){
		//Funzione che manda al tab casa (quindi senza geolocalizzazione)
    	alert("ha indirizzo");
    	
		//Tira giù i dati della casa dal DB
		//Poi fai un controllo...se ha più indirizzi salvati...se ne ha 1 
    	//visualizzi il tab normale senò quello con più opzioni
    	
		numero_case = 1; //il numero di case viene richiesto dal server

		//Fa un controllo, se c'è solo una casa mostra il tab normale, altrimenti mostra
		//l'elenco
		if(numero_case < 2){
			//Il tab casa è attivato e viene mostrato il div #tabCasa
	    	$('#tab_casa').attr('class','active');
	    	$('#tab_casa').html('<a href="#tabCasa" data-toggle="tab">Casa</a>');	
		}
		else{
			$('#tab_casa').attr('class','dropdown');
	    	$('#tab_casa').html('<a href="#tabCasa" class="dropdown-toggle" data-toggle="dropdown">Casa <b class="caret"></b></a>'+
	    		'<ul class="dropdown-menu">'+
	    		'<li>Casa Mare</li>'+
	    		'<li>Ufficio</li>'+
	    		'</ul>');	
		}
			
		//Il tab altro è cliccabile e viene mostrato il div #tabAltro
		$('#tab_altro').attr('class','');
		$('#tab_altro').html('<a onclick="goTabAltro(true)" data-toggle="tab">Altro</a>');
		
		//Attivo la pagina tabCasa e disattivo tabAltro
		$('#tabAltro').attr('class','tab-pane');
		$('#tabCasa').attr('class','tab-pane active');
		

		//Mostra la casa sulla mappa
		$('#map_casa').html('<h2>La posizione della casa</h2><span id="posizione_casa"></span>');
		
		//faccio chiamata al database e mi darà tutti i dati della casa
		//dati di prova
		indirizzo ="via cantoncello";
		nciv="31";
		cap="40026";
		citta="Imola";
		provincia="BO";
		//
		$('#Indirizzo_casa').attr('value',indirizzo);
		$('#nCiv_casa').attr('value',nciv);
		$('#CAP_casa').attr('value',cap);
		$('#Citta_casa').attr('value',citta);
		$('#Provincia_casa').attr('value',provincia);
    }
    
    </script>
  
  
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" style="height:10%;">
    	<div class="navbar-inner">
	    	<img src="./img/logo_cropped.png" width="35%" style="max-width:180px; margin:auto 0; margin-left:5px;">
            
	          	<div class=" btn-group pull-right" style="margin:0.7% 0;">          		
	                <button class="btn btn-large btn-inverse notifiche" type="button" data-toggle="popover" title="Notifiche:">
	                	<span style="margin-top:4%; margin-bottom:5%" class="badge badge-important">4</span>
	                </button>
		            <button  class="btn btn-large btn-inverse" type="button">
		            	<!-- l'altezza ideale per le ico dei bottoni è 22px perchè è la stessa del popover di cui sopra -->
		            	<img src="./img/glyphicons/white_ver/243.PNG" style="height:22px;">
		            </button>
		            <button class="btn btn-large btn-inverse" type="button">
		            	<img src="./img/glyphicons/white_ver/138.PNG" style="height:22px;">
		            </button>
              </div>
	    </div>
	</div>


    <div class="container contNotifiche">
		<div class="row-fluid">
			<div class="span12" style="text-align:center;">
			
				<div class="tabbable"> <!-- Only required for left/right tabs -->
  					<ul class="nav nav-tabs span12">
  					
  						<li id="tab_casa" class="" style="width:50%">Casa</li>
    					<li id="tab_altro" class="" style="width:50%">Altro</li>
  						
  					</ul>
  					
    					<div class="tab-content">
    					
	    					<!--  Sezione Casa  -->
	    					<div class="tab-pane" id="tabCasa">
	    					
								<!-- Parte dove ci andrà la mappa di google -->
								<div id="map_casa" style="border: 1px solid #999;"></div>
								<!-- Fine parte dove ci andrà la mappa di google -->
	      						
	      						<!-- Form per indirizzo -->
								<br />
								<form class="form-horizontal">
									<div class="controls">
	  									<input id="Indirizzo_casa" type="text" style="width:70%" value="Indirizzo"><br /><br />
	  									<input id="nCiv_casa" type="text" style="width:70%" value="N. Civ."><br /><br />
	  									<input id="CAP_casa" type="text" style="width:70%" value="CAP"><br /><br />
	  									<input id="Citta_casa" type="text" style="width:70%" value="Citta"><br /><br />
	  									<input id="Provincia_casa" type="text" style="width:70%" value="Prov."><br /><br />
									</div>
									<button class="btn btn-large btn-block btn-inverse" type="button" onclick="javascript:window.location='intervento-modalita.html';">Avanti <img src="./img/glyphicons/black_ver/glyphicons_223_chevron-right.png"/></button>
								</form>
	      						
	    					</div>
    					
    					<div class="tab-pane" id="tabAltro">
      						
      						<!--  Sezione Altro  -->
      						
      						<!-- Parte dove ci andrà la mappa di google -->
							<div id="map_altro" style="border: 1px solid #999;">
							    <!-- <menu type="toolbar">
							        <button type="button" onclick="sospendiLaRicezione()">
							            sospendi la ricezione di dati geospaziali
							        </button>
							    </menu>   -->  
							</div>
							<!-- Fine parte dove ci andrà la mappa di google -->
							
							
							<!-- Form per indirizzo -->
							<br />
							<form class="form-horizontal">

								<div class="controls">
  									<input id="Indirizzo_altro" type="text" style="width:70%" value="Indirizzo"><br /><br />
  									<input id="nCiv_altro" type="text" style="width:70%" value="N. Civ."><br /><br />
  									<input id="CAP_altro" type="text" style="width:70%" value="CAP"><br /><br />
  									<input id="Citta_altro" type="text" style="width:70%" value="Citta"><br /><br />
  									<input id="Provincia_altro" type="text" style="width:70%" value="Prov."><br /><br />
								</div>
								<a href="#myModal" role="button" class="btn btn-large btn-block btn-success" data-toggle="modal">Salva Luogo</a>
								<button class="btn btn-large btn-block btn-inverse" type="button" onclick="javascript:window.location='intervento-modalita.html';">Avanti <img src="./img/glyphicons/black_ver/glyphicons_223_chevron-right.png"/></button>
							

							</form>
							
							<!-- Modal -->
							<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							  <div class="modal-header">
							    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
							    <h3 id="myModalLabel">Nome Luogo</h3>
							  </div>
							  <div class="modal-body">
							    <p>Assegna un nome al luogo</p>
							    <input id="nome_luogo" type="text" placeholder="Luogo">
							  </div>
							  <div class="modal-footer">	
							    	<button class="btn" data-dismiss="modal" aria-hidden="true">Annulla</button>
							    	<button class="btn btn-primary" onclick="">Salva</button>
							  </div>
							</div>
	
    					</div>
  					</div>
				</div>
			
			</div>

		</div>

    </div> <!-- /container -->
   

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./js/jquery.js"></script>
    <script src="./js/bootstrap.js"></script>
    <script src="./js/jasny-bootstrap.js"></script>
	<script src="./js/function.js"></script>
	<!--  <script src="./js/function_geoloc.js"></script> -->
  </body>
</html>
